{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(login),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(signUpSaga),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(sendResetCodeSaga),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(resetPasswordSaga),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(logOutSaga),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(Saga);\n\nimport { AUTH_REQUEST, AUTH_FAILURE, AUTH_SUCCESS, SIGNUP_REQUEST, SIGNUP_SUCCESS, SIGNUP_FAILURE, loginRequest, LOGOUT_REQUEST, LOGOUT_SUCCESS, LOGOUT_FAILURE, SEND_RESET_CODE_REQUEST, SEND_RESET_CODE_SUCCESS, SEND_RESET_CODE_FAILURE, RESET_PASSWORD_FAILURE, RESET_PASSWORD_REQUEST, RESET_PASSWORD_SUCCESS } from \"./actions\";\nimport { call, put, takeLatest } from \"redux-saga/effects\";\nimport { Post, PostFormData } from \"../services\";\nimport { LOADER_START, LOADER_END } from \"../loader/actions\";\nimport { writeLocalStorage, removeLocalStorage } from \"../helpers\";\nimport { LOGIN_ERROR_START, EMAIL_ERROR_START, USERNAME_ERROR_START } from \"../error/actions\";\nimport { toast } from \"react-toastify\";\nimport RollbarErrorTracking from \"../../components/RollbarErrorTracking\";\nimport Router from 'next/router';\nimport { setCookie, destroyCookie } from \"nookies\";\n\nfunction login(_ref) {\n  var payload, response;\n  return _regeneratorRuntime.wrap(function login$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          payload = _ref.payload;\n          _context.prev = 1;\n          _context.next = 4;\n          return put({\n            type: LOADER_START\n          });\n\n        case 4:\n          _context.next = 6;\n          return call(Post, \"auth/login\", payload, true);\n\n        case 6:\n          response = _context.sent;\n          console.log(response);\n\n          if (!(response && response.success)) {\n            _context.next = 18;\n            break;\n          }\n\n          writeLocalStorage('token', response.token);\n          writeLocalStorage('user', response.user);\n          setCookie(null, 'token', response.token, {\n            maxAge: 10 * 365 * 24 * 60 * 60,\n            path: '/'\n          });\n          _context.next = 14;\n          return call(Router.push('/'));\n\n        case 14:\n          _context.next = 16;\n          return put({\n            type: AUTH_SUCCESS,\n            payload: response\n          });\n\n        case 16:\n          _context.next = 24;\n          break;\n\n        case 18:\n          _context.next = 20;\n          return put({\n            type: AUTH_FAILURE,\n            payload: response\n          });\n\n        case 20:\n          _context.next = 22;\n          return put({\n            type: LOGIN_ERROR_START\n          });\n\n        case 22:\n          _context.next = 24;\n          return put({\n            type: LOADER_END\n          });\n\n        case 24:\n          _context.next = 34;\n          break;\n\n        case 26:\n          _context.prev = 26;\n          _context.t0 = _context[\"catch\"](1);\n          _context.next = 30;\n          return put({\n            type: AUTH_FAILURE,\n            payload: _context.t0\n          });\n\n        case 30:\n          _context.next = 32;\n          return put({\n            type: LOGIN_ERROR_START\n          });\n\n        case 32:\n          _context.next = 34;\n          return put({\n            type: LOADER_END\n          });\n\n        case 34:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[1, 26]]);\n}\n\nfunction signUpSaga(_ref2) {\n  var payload, values, response;\n  return _regeneratorRuntime.wrap(function signUpSaga$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          payload = _ref2.payload;\n          values = {\n            username: payload.username,\n            password: payload.password\n          };\n          _context2.prev = 2;\n          _context2.next = 5;\n          return put({\n            type: LOADER_START\n          });\n\n        case 5:\n          _context2.next = 7;\n          return call(PostFormData, \"user/create-user\", payload, {});\n\n        case 7:\n          response = _context2.sent;\n\n          if (!(response && !response.error && response.success)) {\n            _context2.next = 15;\n            break;\n          }\n\n          _context2.next = 11;\n          return put({\n            type: SIGNUP_SUCCESS,\n            payload: response\n          });\n\n        case 11:\n          _context2.next = 13;\n          return put(loginRequest(values.username, values.password));\n\n        case 13:\n          _context2.next = 31;\n          break;\n\n        case 15:\n          if (!response.emailAddress) {\n            _context2.next = 20;\n            break;\n          }\n\n          _context2.next = 18;\n          return put({\n            type: EMAIL_ERROR_START\n          });\n\n        case 18:\n          _context2.next = 26;\n          break;\n\n        case 20:\n          if (!response.username) {\n            _context2.next = 25;\n            break;\n          }\n\n          _context2.next = 23;\n          return put({\n            type: USERNAME_ERROR_START\n          });\n\n        case 23:\n          _context2.next = 26;\n          break;\n\n        case 25:\n          RollbarErrorTracking.logErroInfo(JSON.stringify(response));\n\n        case 26:\n          _context2.next = 28;\n          return put({\n            type: SIGNUP_FAILURE,\n            payload: response\n          });\n\n        case 28:\n          _context2.next = 30;\n          return put({\n            type: LOADER_END\n          });\n\n        case 30:\n          RollbarErrorTracking.logErroInfo(JSON.stringify(response));\n\n        case 31:\n          _context2.next = 40;\n          break;\n\n        case 33:\n          _context2.prev = 33;\n          _context2.t0 = _context2[\"catch\"](2);\n          _context2.next = 37;\n          return put({\n            type: SIGNUP_FAILURE,\n            payload: _context2.t0\n          });\n\n        case 37:\n          _context2.next = 39;\n          return put({\n            type: LOADER_END\n          });\n\n        case 39:\n          RollbarErrorTracking.logErroInfo(JSON.stringify(_context2.t0));\n\n        case 40:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2, null, [[2, 33]]);\n}\n\nfunction sendResetCodeSaga(payload) {\n  var response;\n  return _regeneratorRuntime.wrap(function sendResetCodeSaga$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          _context3.next = 3;\n          return put({\n            type: LOADER_START\n          });\n\n        case 3:\n          _context3.next = 5;\n          return call(Post, \"auth/send-reset-code?emailAddress=\".concat(payload.emailAddress), {}, {});\n\n        case 5:\n          response = _context3.sent;\n\n          if (!(response && !response.error && response.status)) {\n            _context3.next = 16;\n            break;\n          }\n\n          _context3.next = 9;\n          return put({\n            type: SEND_RESET_CODE_SUCCESS,\n            payload: response\n          });\n\n        case 9:\n          _context3.next = 11;\n          return put({\n            type: LOADER_END\n          });\n\n        case 11:\n          toast.success(\"E-postanızı kontrol edin\");\n          _context3.next = 14;\n          return call(Router.push('/sifre-sifirla'));\n\n        case 14:\n          _context3.next = 20;\n          break;\n\n        case 16:\n          _context3.next = 18;\n          return put({\n            type: SEND_RESET_CODE_FAILURE,\n            payload: response\n          });\n\n        case 18:\n          _context3.next = 20;\n          return put({\n            type: LOADER_END\n          });\n\n        case 20:\n          _context3.next = 28;\n          break;\n\n        case 22:\n          _context3.prev = 22;\n          _context3.t0 = _context3[\"catch\"](0);\n          _context3.next = 26;\n          return put({\n            type: SEND_RESET_CODE_FAILURE,\n            payload: _context3.t0\n          });\n\n        case 26:\n          _context3.next = 28;\n          return put({\n            type: LOADER_END\n          });\n\n        case 28:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[0, 22]]);\n}\n\nfunction resetPasswordSaga(_ref3) {\n  var payload, response;\n  return _regeneratorRuntime.wrap(function resetPasswordSaga$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          payload = _ref3.payload;\n          _context4.prev = 1;\n          _context4.next = 4;\n          return put({\n            type: LOADER_START\n          });\n\n        case 4:\n          _context4.next = 6;\n          return call(Post, \"auth/reset-password\", payload, {});\n\n        case 6:\n          response = _context4.sent;\n\n          if (!(response && !response.error && response.status)) {\n            _context4.next = 17;\n            break;\n          }\n\n          _context4.next = 10;\n          return put({\n            type: RESET_PASSWORD_SUCCESS,\n            payload: response\n          });\n\n        case 10:\n          toast.success(\"Şifre başarıyla değiştirildi\");\n          _context4.next = 13;\n          return put({\n            type: LOADER_END\n          });\n\n        case 13:\n          _context4.next = 15;\n          return call(Router.push('/giris-yap'));\n\n        case 15:\n          _context4.next = 21;\n          break;\n\n        case 17:\n          _context4.next = 19;\n          return put({\n            type: RESET_PASSWORD_FAILURE,\n            payload: response\n          });\n\n        case 19:\n          _context4.next = 21;\n          return put({\n            type: LOADER_END\n          });\n\n        case 21:\n          _context4.next = 29;\n          break;\n\n        case 23:\n          _context4.prev = 23;\n          _context4.t0 = _context4[\"catch\"](1);\n          _context4.next = 27;\n          return put({\n            type: RESET_PASSWORD_FAILURE,\n            payload: _context4.t0\n          });\n\n        case 27:\n          _context4.next = 29;\n          return put({\n            type: LOADER_END\n          });\n\n        case 29:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4, null, [[1, 23]]);\n}\n\nfunction logOutSaga() {\n  return _regeneratorRuntime.wrap(function logOutSaga$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.prev = 0;\n          _context5.next = 3;\n          return put({\n            type: LOGOUT_SUCCESS\n          });\n\n        case 3:\n          removeLocalStorage(\"token\");\n          removeLocalStorage(\"user\");\n          localStorage.clear();\n          sessionStorage.clear();\n          destroyCookie(null, 'token');\n          _context5.next = 10;\n          return put({\n            type: \"RESET\"\n          });\n\n        case 10:\n          _context5.next = 12;\n          return call(Router.push('/giris-yap'));\n\n        case 12:\n          _context5.next = 18;\n          break;\n\n        case 14:\n          _context5.prev = 14;\n          _context5.t0 = _context5[\"catch\"](0);\n          _context5.next = 18;\n          return put({\n            type: LOGOUT_FAILURE\n          });\n\n        case 18:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5, null, [[0, 14]]);\n}\n\nexport default function Saga() {\n  return _regeneratorRuntime.wrap(function Saga$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return takeLatest(AUTH_REQUEST, login);\n\n        case 2:\n          _context6.next = 4;\n          return takeLatest(SIGNUP_REQUEST, signUpSaga);\n\n        case 4:\n          _context6.next = 6;\n          return takeLatest(LOGOUT_REQUEST, logOutSaga);\n\n        case 6:\n          _context6.next = 8;\n          return takeLatest(SEND_RESET_CODE_REQUEST, sendResetCodeSaga);\n\n        case 8:\n          _context6.next = 10;\n          return takeLatest(RESET_PASSWORD_REQUEST, resetPasswordSaga);\n\n        case 10:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6);\n}\n_c = Saga;\n\nvar _c;\n\n$RefreshReg$(_c, \"Saga\");","map":{"version":3,"sources":["D:/repos/saalla-next.js/lib/auth/sagas.js"],"names":["login","signUpSaga","sendResetCodeSaga","resetPasswordSaga","logOutSaga","Saga","AUTH_REQUEST","AUTH_FAILURE","AUTH_SUCCESS","SIGNUP_REQUEST","SIGNUP_SUCCESS","SIGNUP_FAILURE","loginRequest","LOGOUT_REQUEST","LOGOUT_SUCCESS","LOGOUT_FAILURE","SEND_RESET_CODE_REQUEST","SEND_RESET_CODE_SUCCESS","SEND_RESET_CODE_FAILURE","RESET_PASSWORD_FAILURE","RESET_PASSWORD_REQUEST","RESET_PASSWORD_SUCCESS","call","put","takeLatest","Post","PostFormData","LOADER_START","LOADER_END","writeLocalStorage","removeLocalStorage","LOGIN_ERROR_START","EMAIL_ERROR_START","USERNAME_ERROR_START","toast","RollbarErrorTracking","Router","setCookie","destroyCookie","payload","type","response","console","log","success","token","user","maxAge","path","push","values","username","password","error","emailAddress","logErroInfo","JSON","stringify","status","localStorage","clear","sessionStorage"],"mappings":"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","sourcesContent":["import {\r\n    AUTH_REQUEST, AUTH_FAILURE, AUTH_SUCCESS, SIGNUP_REQUEST, SIGNUP_SUCCESS, SIGNUP_FAILURE,\r\n    loginRequest, LOGOUT_REQUEST, LOGOUT_SUCCESS, LOGOUT_FAILURE,\r\n    SEND_RESET_CODE_REQUEST, SEND_RESET_CODE_SUCCESS, SEND_RESET_CODE_FAILURE,\r\n    RESET_PASSWORD_FAILURE, RESET_PASSWORD_REQUEST, RESET_PASSWORD_SUCCESS\r\n} from \"./actions\";\r\nimport { call, put, takeLatest } from \"redux-saga/effects\";\r\nimport { Post, PostFormData } from \"../services\";\r\nimport { LOADER_START, LOADER_END } from \"../loader/actions\";\r\nimport { writeLocalStorage, removeLocalStorage } from \"../helpers\";\r\nimport { LOGIN_ERROR_START, EMAIL_ERROR_START, USERNAME_ERROR_START } from \"../error/actions\";\r\nimport { toast } from \"react-toastify\";\r\nimport RollbarErrorTracking from \"../../components/RollbarErrorTracking\";\r\nimport Router from 'next/router'\r\nimport { setCookie, destroyCookie } from \"nookies\";\r\n\r\nfunction* login({ payload }) {\r\n    try {\r\n        yield put({ type: LOADER_START });\r\n        const response = yield call(Post, \"auth/login\", payload, true);\r\n        console.log(response);\r\n        if (response && response.success) {\r\n            writeLocalStorage('token', response.token);\r\n            writeLocalStorage('user', response.user);\r\n            setCookie(null, 'token', response.token, {\r\n                maxAge: 10 * 365 * 24 * 60 * 60,\r\n                path: '/',\r\n            })\r\n            yield call(Router.push('/'))\r\n            yield put({ type: AUTH_SUCCESS, payload: response });\r\n        } else {\r\n            yield put({ type: AUTH_FAILURE, payload: response });\r\n            //RollbarErrorTracking.logErroInfo(JSON.stringify(response))\r\n            yield put({ type: LOGIN_ERROR_START });\r\n            yield put({ type: LOADER_END });\r\n        }\r\n    } catch (error) {\r\n        yield put({ type: AUTH_FAILURE, payload: error });\r\n        //  RollbarErrorTracking.logErroInfo(JSON.stringify(error))\r\n        yield put({ type: LOGIN_ERROR_START });\r\n        yield put({ type: LOADER_END });\r\n    }\r\n}\r\n\r\nfunction* signUpSaga({ payload }) {\r\n    const values = { username: payload.username, password: payload.password };\r\n    try {\r\n        yield put({ type: LOADER_START });\r\n        const response = yield call(PostFormData, \"user/create-user\", payload, {});\r\n        if (response && !response.error && response.success) {\r\n            yield put({ type: SIGNUP_SUCCESS, payload: response });\r\n            yield put(loginRequest(values.username, values.password));\r\n        } else {\r\n            if (response.emailAddress) {\r\n                yield put({ type: EMAIL_ERROR_START })\r\n            } else if (response.username) {\r\n                yield put({ type: USERNAME_ERROR_START });\r\n            } else {\r\n                RollbarErrorTracking.logErroInfo(JSON.stringify(response))\r\n            }\r\n            yield put({ type: SIGNUP_FAILURE, payload: response });\r\n            yield put({ type: LOADER_END });\r\n            RollbarErrorTracking.logErroInfo(JSON.stringify(response))\r\n        }\r\n    } catch (error) {\r\n        yield put({ type: SIGNUP_FAILURE, payload: error });\r\n        yield put({ type: LOADER_END });\r\n        RollbarErrorTracking.logErroInfo(JSON.stringify(error))\r\n    }\r\n}\r\n\r\nfunction* sendResetCodeSaga(payload) {\r\n    try {\r\n        yield put({ type: LOADER_START });\r\n        const response = yield call(Post, `auth/send-reset-code?emailAddress=${payload.emailAddress}`, {}, {});\r\n        if (response && !response.error && response.status) {\r\n            yield put({ type: SEND_RESET_CODE_SUCCESS, payload: response });\r\n            yield put({ type: LOADER_END });\r\n            toast.success(\"E-postanızı kontrol edin\")\r\n            yield call(Router.push('/sifre-sifirla'))\r\n        } else {\r\n            yield put({ type: SEND_RESET_CODE_FAILURE, payload: response });\r\n            yield put({ type: LOADER_END });\r\n        }\r\n    } catch (error) {\r\n        yield put({ type: SEND_RESET_CODE_FAILURE, payload: error });\r\n        yield put({ type: LOADER_END });\r\n    }\r\n}\r\n\r\nfunction* resetPasswordSaga({ payload }) {\r\n    try {\r\n        yield put({ type: LOADER_START });\r\n        const response = yield call(Post, \"auth/reset-password\", payload, {});\r\n        if (response && !response.error && response.status) {\r\n            yield put({ type: RESET_PASSWORD_SUCCESS, payload: response });\r\n            toast.success(\"Şifre başarıyla değiştirildi\")\r\n            yield put({ type: LOADER_END });\r\n            yield call(Router.push('/giris-yap'))\r\n        } else {\r\n            yield put({ type: RESET_PASSWORD_FAILURE, payload: response });\r\n            yield put({ type: LOADER_END });\r\n        }\r\n    } catch (error) {\r\n        yield put({ type: RESET_PASSWORD_FAILURE, payload: error });\r\n        yield put({ type: LOADER_END });\r\n    }\r\n}\r\n\r\nfunction* logOutSaga() {\r\n    try {\r\n        yield put({ type: LOGOUT_SUCCESS });\r\n        removeLocalStorage(\"token\");\r\n        removeLocalStorage(\"user\");\r\n        localStorage.clear();\r\n        sessionStorage.clear();\r\n        destroyCookie(null, 'token')\r\n        yield put({ type: \"RESET\" });\r\n        yield call(Router.push('/giris-yap'))\r\n    } catch (error) {\r\n        yield put({ type: LOGOUT_FAILURE });\r\n    }\r\n}\r\n\r\nexport default function* Saga() {\r\n    yield takeLatest(AUTH_REQUEST, login);\r\n    yield takeLatest(SIGNUP_REQUEST, signUpSaga);\r\n    yield takeLatest(LOGOUT_REQUEST, logOutSaga);\r\n    yield takeLatest(SEND_RESET_CODE_REQUEST, sendResetCodeSaga);\r\n    yield takeLatest(RESET_PASSWORD_REQUEST, resetPasswordSaga);\r\n}"]},"metadata":{},"sourceType":"module"}